{"openapi":"3.1.0","info":{"title":"Payment System with Face Recognition","description":"A comprehensive payment system API with face recognition capabilities","version":"1.0.0"},"paths":{"/health":{"get":{"summary":"Health Check","description":"Health check endpoint","operationId":"health_check_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/":{"get":{"summary":"Root","description":"Root endpoint","operationId":"root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/verification/send-phone-code":{"post":{"tags":["Verification"],"summary":"Send Phone Verification Code","description":"Send SMS verification code to phone number using Prelude.so","operationId":"send_phone_verification_code_verification_send_phone_code_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PhoneVerificationRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/VerificationResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/verification/verify-phone-code":{"post":{"tags":["Verification"],"summary":"Verify Phone Code","description":"Verify SMS code for phone number using Prelude.so","operationId":"verify_phone_code_verification_verify_phone_code_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/VerificationCodeRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/VerificationResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/verification/send-email-code":{"post":{"tags":["Verification"],"summary":"Send Email Verification Code","description":"Send email verification code (placeholder - Prelude.so focuses on SMS)","operationId":"send_email_verification_code_verification_send_email_code_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/EmailVerificationRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/VerificationResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/verification/verify-email-code":{"post":{"tags":["Verification"],"summary":"Verify Email Code","description":"Verify email code (placeholder implementation)","operationId":"verify_email_code_verification_verify_email_code_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/EmailVerificationCodeRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/VerificationResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/register":{"post":{"tags":["Authentication"],"summary":"Register User","description":"Register a new user (requires phone verification only)\n\nRequired fields:\n- full_name: User's full name (first and last name)\n- email: User's email address  \n- phone_number: Phone number in E.164 format (+1234567890)\n- password: Strong password (min 8 chars, 1 number, 1 letter, 1 special char)","operationId":"register_user_auth_register_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PhoneVerifiedUserRegistration"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/register-legacy":{"post":{"tags":["Authentication"],"summary":"Register User Legacy","description":"Register a new user (legacy endpoint - deprecated)","operationId":"register_user_legacy_auth_register_legacy_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserRegistration"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"deprecated":true}},"/auth/login":{"post":{"tags":["Authentication"],"summary":"Login User","description":"Authenticate user and return tokens","operationId":"login_user_auth_login_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserLogin"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Token"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/refresh":{"post":{"tags":["Authentication"],"summary":"Refresh Access Token","description":"Refresh access token using refresh token","operationId":"refresh_access_token_auth_refresh_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RefreshTokenRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AccessTokenResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/logout":{"post":{"tags":["Authentication"],"summary":"Logout User","description":"Logout user by revoking refresh token","operationId":"logout_user_auth_logout_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RefreshTokenRequest"}}},"required":true},"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/register-frontend":{"post":{"tags":["Authentication"],"summary":"Register User Frontend","description":"Register a new user (frontend compatible)\n\nRequired fields:\n- first_name: User's first name\n- last_name: User's last name  \n- email: User's email address  \n- phone_number: Phone number in E.164 format (+1234567890)\n- password: Password (min 6 chars)\n- verification_code: SMS verification code","operationId":"register_user_frontend_auth_register_frontend_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FrontendUserRegistration"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/debug-verification":{"post":{"tags":["Authentication"],"summary":"Debug Phone Verification","description":"Debug endpoint to test phone verification directly (for troubleshooting)","operationId":"debug_phone_verification_auth_debug_verification_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Body_debug_phone_verification_auth_debug_verification_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/forgot-password/request":{"post":{"tags":["Authentication"],"summary":"Request Password Reset","description":"Request password reset by sending verification code to phone number","operationId":"request_password_reset_auth_forgot_password_request_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Body_request_password_reset_auth_forgot_password_request_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/auth/forgot-password/verify":{"post":{"tags":["Authentication"],"summary":"Verify Password Reset","description":"Reset password after verifying phone number","operationId":"verify_password_reset_auth_forgot_password_verify_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Body_verify_password_reset_auth_forgot_password_verify_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/users/me":{"get":{"tags":["Users"],"summary":"Get Current User Profile","description":"Get current user profile","operationId":"get_current_user_profile_users_me_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]}]},"put":{"tags":["Users"],"summary":"Update Current User Profile","description":"Update current user profile","operationId":"update_current_user_profile_users_me_put","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserUpdate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/users/me/face-status":{"get":{"tags":["Users"],"summary":"Get User Face Status","description":"Get user's face enrollment status","operationId":"get_user_face_status_users_me_face_status_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FaceStatusResponse"}}}}},"security":[{"HTTPBearer":[]}]},"put":{"tags":["Users"],"summary":"Update Face Status","description":"Update user's face registration status","operationId":"update_face_status_users_me_face_status_put","requestBody":{"content":{"application/json":{"schema":{"type":"object","title":"Face Status"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/users/me/face-enrollment":{"delete":{"tags":["Users"],"summary":"Delete Face Enrollment","description":"Delete user's face enrollment","operationId":"delete_face_enrollment_users_me_face_enrollment_delete","responses":{"204":{"description":"Successful Response"}},"security":[{"HTTPBearer":[]}]}},"/users/":{"delete":{"tags":["Users"],"summary":"Delete User","description":"Delete a user **permanently** by phone number **or** e-mail.\n\nPass the value through query parameter `identifier`. The backend will try\nto match the provided string against both `phone_number` and `email`\ncolumns. If a matching user is found the record (and everything that has\na cascading foreign-key relationship to it) will be removed.\n\nA HTTP 404 error is returned when no account matches the supplied\nidentifier.","operationId":"delete_user_users__delete","parameters":[{"name":"identifier","in":"query","required":true,"schema":{"type":"string","title":"Identifier"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/users":{"delete":{"tags":["Users"],"summary":"Delete User","description":"Delete a user **permanently** by phone number **or** e-mail.\n\nPass the value through query parameter `identifier`. The backend will try\nto match the provided string against both `phone_number` and `email`\ncolumns. If a matching user is found the record (and everything that has\na cascading foreign-key relationship to it) will be removed.\n\nA HTTP 404 error is returned when no account matches the supplied\nidentifier.","operationId":"delete_user_users_delete","parameters":[{"name":"identifier","in":"query","required":true,"schema":{"type":"string","title":"Identifier"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/users/me/payment-methods/setup-intent":{"post":{"tags":["Payment Methods"],"summary":"Create Setup Intent","description":"Create a Setup Intent for saving a new payment method","operationId":"create_setup_intent_users_me_payment_methods_setup_intent_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}},"security":[{"HTTPBearer":[]}]}},"/users/me/payment-methods/confirm-setup-intent/{setup_intent_id}":{"post":{"tags":["Payment Methods"],"summary":"Confirm Setup Intent And Save Card","description":"Confirm Setup Intent and save the payment method","operationId":"confirm_setup_intent_and_save_card_users_me_payment_methods_confirm_setup_intent__setup_intent_id__post","security":[{"HTTPBearer":[]}],"parameters":[{"name":"setup_intent_id","in":"path","required":true,"schema":{"type":"string","title":"Setup Intent Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/users/me/payment-methods/":{"get":{"tags":["Payment Methods"],"summary":"Get User Payment Methods","description":"Get all payment methods for the current user","operationId":"get_user_payment_methods_users_me_payment_methods__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/PaymentMethodResponse"},"type":"array","title":"Response Get User Payment Methods Users Me Payment Methods  Get"}}}}},"security":[{"HTTPBearer":[]}]},"post":{"tags":["Payment Methods"],"summary":"Add Payment Method","description":"Add a new payment method for the current user","operationId":"add_payment_method_users_me_payment_methods__post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaymentMethodCreate"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaymentMethodResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/users/me/payment-methods/secure":{"post":{"tags":["Payment Methods"],"summary":"Add Payment Method Secure","description":"Add a new payment method for the current user (SECURE VERSION)\nFrontend sends only Stripe payment method ID, backend fetches details from Stripe","operationId":"add_payment_method_secure_users_me_payment_methods_secure_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaymentMethodCreateSecure"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaymentMethodResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/users/me/payment-methods/{payment_method_id}":{"put":{"tags":["Payment Methods"],"summary":"Update Payment Method","description":"Update a payment method for the current user","operationId":"update_payment_method_users_me_payment_methods__payment_method_id__put","security":[{"HTTPBearer":[]}],"parameters":[{"name":"payment_method_id","in":"path","required":true,"schema":{"type":"string","title":"Payment Method Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaymentMethodUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaymentMethodResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["Payment Methods"],"summary":"Delete Payment Method","description":"Delete a payment method for the current user","operationId":"delete_payment_method_users_me_payment_methods__payment_method_id__delete","security":[{"HTTPBearer":[]}],"parameters":[{"name":"payment_method_id","in":"path","required":true,"schema":{"type":"string","title":"Payment Method Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/users/me/auto-pay/":{"get":{"tags":["Auto-Pay"],"summary":"Get Auto Pay Approvals","description":"Get all auto-pay approvals for the current user","operationId":"get_auto_pay_approvals_users_me_auto_pay__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/AutoPayApprovalResponse"},"type":"array","title":"Response Get Auto Pay Approvals Users Me Auto Pay  Get"}}}}},"security":[{"HTTPBearer":[]}]},"post":{"tags":["Auto-Pay"],"summary":"Create Or Update Auto Pay Approval","description":"Create or update auto-pay approval for a merchant","operationId":"create_or_update_auto_pay_approval_users_me_auto_pay__post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AutoPayApprovalCreate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AutoPayApprovalResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/users/me/auto-pay/{merchant_id}":{"delete":{"tags":["Auto-Pay"],"summary":"Delete Auto Pay Approval","description":"Delete auto-pay approval for a specific merchant","operationId":"delete_auto_pay_approval_users_me_auto_pay__merchant_id__delete","security":[{"HTTPBearer":[]}],"parameters":[{"name":"merchant_id","in":"path","required":true,"schema":{"type":"string","format":"uuid","title":"Merchant Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/users/me/autopay/":{"get":{"tags":["AutoPay"],"summary":"Get Auto Pays","description":"Get all auto-pay settings for the current user","operationId":"get_auto_pays_users_me_autopay__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/AutoPayResponse"},"type":"array","title":"Response Get Auto Pays Users Me Autopay  Get"}}}}},"security":[{"HTTPBearer":[]}]},"post":{"tags":["AutoPay"],"summary":"Create Auto Pay","description":"Create a new auto-pay setting","operationId":"create_auto_pay_users_me_autopay__post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AutoPayCreate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AutoPayResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/users/me/autopay/{auto_pay_id}":{"put":{"tags":["AutoPay"],"summary":"Update Auto Pay","description":"Update an auto-pay setting","operationId":"update_auto_pay_users_me_autopay__auto_pay_id__put","security":[{"HTTPBearer":[]}],"parameters":[{"name":"auto_pay_id","in":"path","required":true,"schema":{"type":"string","title":"Auto Pay Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AutoPayUpdate"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/AutoPayResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["AutoPay"],"summary":"Delete Auto Pay","description":"Delete an auto-pay setting","operationId":"delete_auto_pay_users_me_autopay__auto_pay_id__delete","security":[{"HTTPBearer":[]}],"parameters":[{"name":"auto_pay_id","in":"path","required":true,"schema":{"type":"string","title":"Auto Pay Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/users/me/autopay/merchant/{merchant_id}":{"delete":{"tags":["AutoPay"],"summary":"Delete Auto Pay By Merchant","description":"Delete auto-pay setting for a specific merchant","operationId":"delete_auto_pay_by_merchant_users_me_autopay_merchant__merchant_id__delete","security":[{"HTTPBearer":[]}],"parameters":[{"name":"merchant_id","in":"path","required":true,"schema":{"type":"string","title":"Merchant Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/users/me/transactions/":{"get":{"tags":["Transactions"],"summary":"Get Transactions","description":"Get transactions for the current user with optional filtering","operationId":"get_transactions_users_me_transactions__get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"status_filter","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"description":"Filter by status: 'completed', 'pending', 'failed', 'cancelled'","title":"Status Filter"},"description":"Filter by status: 'completed', 'pending', 'failed', 'cancelled'"},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"description":"Maximum number of transactions to return","default":50,"title":"Limit"},"description":"Maximum number of transactions to return"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/TransactionResponse"},"title":"Response Get Transactions Users Me Transactions  Get"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/users/me/transactions/{transaction_id}":{"get":{"tags":["Transactions"],"summary":"Get Transaction Detail","description":"Get detailed information about a specific transaction","operationId":"get_transaction_detail_users_me_transactions__transaction_id__get","security":[{"HTTPBearer":[]}],"parameters":[{"name":"transaction_id","in":"path","required":true,"schema":{"type":"string","title":"Transaction Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/TransactionDetailResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/users/me/payments/":{"get":{"tags":["Payments"],"summary":"Get Payment Requests","description":"Get all payment requests for the current user","operationId":"get_payment_requests_users_me_payments__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/IncomingPaymentRequestResponse"},"type":"array","title":"Response Get Payment Requests Users Me Payments  Get"}}}}},"security":[{"HTTPBearer":[]}]},"post":{"tags":["Payments"],"summary":"Create Payment Request","description":"Create a new payment request (can be called by user or merchant)","operationId":"create_payment_request_users_me_payments__post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/IncomingPaymentRequestCreate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"HTTPBearer":[]}]}},"/users/me/payments/{request_id}/approve":{"post":{"tags":["Payments"],"summary":"Approve Payment Request","description":"Approve a pending payment request","operationId":"approve_payment_request_users_me_payments__request_id__approve_post","security":[{"HTTPBearer":[]}],"parameters":[{"name":"request_id","in":"path","required":true,"schema":{"type":"string","title":"Request Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaymentApprovalResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/users/me/payments/{request_id}/decline":{"post":{"tags":["Payments"],"summary":"Decline Payment Request","description":"Decline a pending payment request","operationId":"decline_payment_request_users_me_payments__request_id__decline_post","security":[{"HTTPBearer":[]}],"parameters":[{"name":"request_id","in":"path","required":true,"schema":{"type":"string","title":"Request Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PaymentDeclineResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/users/me/payment-requests/":{"get":{"tags":["Payment Requests"],"summary":"Get Payment Requests","description":"Get all payment requests for the current user","operationId":"get_payment_requests_users_me_payment_requests__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"type":"object"},"type":"array","title":"Response Get Payment Requests Users Me Payment Requests  Get"}}}}},"security":[{"HTTPBearer":[]}]}},"/payment-requests/":{"post":{"tags":["Merchant Payment Requests"],"summary":"Create Payment Request","description":"Create a payment request from merchant to user\nThis endpoint is called by merchant services\n\nNEW: Merchants now send their Stripe Connect account ID directly\nThis eliminates merchant UUID mapping and makes transactions seamless","operationId":"create_payment_request_payment_requests__post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MerchantPaymentRequestCreate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Create Payment Request Payment Requests  Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/payment-requests":{"post":{"tags":["Merchant Payment Requests"],"summary":"Create Payment Request","description":"Create a payment request from merchant to user\nThis endpoint is called by merchant services\n\nNEW: Merchants now send their Stripe Connect account ID directly\nThis eliminates merchant UUID mapping and makes transactions seamless","operationId":"create_payment_request_payment_requests_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MerchantPaymentRequestCreate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","title":"Response Create Payment Request Payment Requests Post"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/users/webhook/stripe":{"post":{"tags":["Webhooks"],"summary":"Handle Stripe Webhook","description":"Handle Stripe webhook events","operationId":"handle_stripe_webhook_users_webhook_stripe_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"AccessTokenResponse":{"properties":{"access_token":{"type":"string","title":"Access Token"},"expires_in":{"type":"integer","title":"Expires In"}},"type":"object","required":["access_token","expires_in"],"title":"AccessTokenResponse"},"AutoPayApprovalCreate":{"properties":{"merchant_id":{"type":"string","title":"Merchant Id"},"limit_amount":{"type":"integer","exclusiveMinimum":0.0,"title":"Limit Amount","description":"Amount in cents"}},"type":"object","required":["merchant_id","limit_amount"],"title":"AutoPayApprovalCreate"},"AutoPayApprovalResponse":{"properties":{"merchant_id":{"type":"string","title":"Merchant Id"},"limit_amount":{"type":"integer","title":"Limit Amount"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"updated_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Updated At"}},"type":"object","required":["merchant_id","limit_amount","created_at"],"title":"AutoPayApprovalResponse"},"AutoPayCreate":{"properties":{"merchant_id":{"type":"string","title":"Merchant Id"},"merchant_name":{"type":"string","title":"Merchant Name"},"payment_method_id":{"type":"string","title":"Payment Method Id"},"max_amount":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Max Amount"},"is_enabled":{"type":"boolean","title":"Is Enabled","default":true}},"type":"object","required":["merchant_id","merchant_name","payment_method_id"],"title":"AutoPayCreate"},"AutoPayResponse":{"properties":{"id":{"type":"string","title":"Id"},"merchant_id":{"type":"string","title":"Merchant Id"},"merchant_name":{"type":"string","title":"Merchant Name"},"is_enabled":{"type":"boolean","title":"Is Enabled"},"max_amount":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Max Amount"},"payment_method_id":{"type":"string","title":"Payment Method Id"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"updated_at":{"type":"string","format":"date-time","title":"Updated At"}},"type":"object","required":["id","merchant_id","merchant_name","is_enabled","max_amount","payment_method_id","created_at","updated_at"],"title":"AutoPayResponse"},"AutoPayUpdate":{"properties":{"is_enabled":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Is Enabled"},"max_amount":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Max Amount"}},"type":"object","title":"AutoPayUpdate"},"Body_debug_phone_verification_auth_debug_verification_post":{"properties":{"phone_number":{"type":"string","title":"Phone Number"},"verification_code":{"type":"string","title":"Verification Code"}},"type":"object","required":["phone_number","verification_code"],"title":"Body_debug_phone_verification_auth_debug_verification_post"},"Body_request_password_reset_auth_forgot_password_request_post":{"properties":{"phone_number":{"type":"string","title":"Phone Number"}},"type":"object","required":["phone_number"],"title":"Body_request_password_reset_auth_forgot_password_request_post"},"Body_verify_password_reset_auth_forgot_password_verify_post":{"properties":{"phone_number":{"type":"string","title":"Phone Number"},"verification_code":{"type":"string","title":"Verification Code"},"new_password":{"type":"string","title":"New Password"}},"type":"object","required":["phone_number","verification_code","new_password"],"title":"Body_verify_password_reset_auth_forgot_password_verify_post"},"EmailVerificationCodeRequest":{"properties":{"email":{"type":"string","format":"email","title":"Email"},"code":{"type":"string","maxLength":10,"minLength":4,"title":"Code","description":"Verification code"}},"type":"object","required":["email","code"],"title":"EmailVerificationCodeRequest"},"EmailVerificationRequest":{"properties":{"email":{"type":"string","format":"email","title":"Email"}},"type":"object","required":["email"],"title":"EmailVerificationRequest"},"FaceStatusResponse":{"properties":{"enrolled":{"type":"boolean","title":"Enrolled"},"face_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Face Id"},"face_created_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Face Created At"}},"type":"object","required":["enrolled","face_id","face_created_at"],"title":"FaceStatusResponse"},"FrontendUserRegistration":{"properties":{"phone_number":{"type":"string","maxLength":16,"minLength":10,"title":"Phone Number","description":"E.164 format phone number (e.g., +1234567890)"},"email":{"type":"string","format":"email","title":"Email","description":"User's email address"},"first_name":{"type":"string","maxLength":50,"minLength":1,"title":"First Name","description":"User's first name"},"last_name":{"type":"string","maxLength":50,"minLength":1,"title":"Last Name","description":"User's last name"},"password":{"type":"string","minLength":6,"title":"Password","description":"Password (min 6 chars)"},"verification_code":{"type":"string","maxLength":10,"minLength":4,"title":"Verification Code","description":"SMS verification code"}},"type":"object","required":["phone_number","email","first_name","last_name","password","verification_code"],"title":"FrontendUserRegistration"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"IncomingPaymentRequestCreate":{"properties":{"merchant_id":{"type":"string","title":"Merchant Id"},"amount":{"type":"integer","exclusiveMinimum":0.0,"title":"Amount","description":"Amount in cents"},"currency":{"type":"string","maxLength":3,"title":"Currency","default":"USD"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"face_scan_id":{"type":"string","title":"Face Scan Id"}},"type":"object","required":["merchant_id","amount","face_scan_id"],"title":"IncomingPaymentRequestCreate"},"IncomingPaymentRequestResponse":{"properties":{"id":{"type":"string","title":"Id"},"merchant_id":{"type":"string","title":"Merchant Id"},"amount":{"type":"integer","title":"Amount"},"currency":{"type":"string","title":"Currency"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"face_scan_id":{"type":"string","title":"Face Scan Id"},"is_auto_paid":{"type":"boolean","title":"Is Auto Paid"},"status":{"$ref":"#/components/schemas/PaymentStatus"},"stripe_payment_intent_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Stripe Payment Intent Id"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"updated_at":{"type":"string","format":"date-time","title":"Updated At"}},"type":"object","required":["id","merchant_id","amount","currency","description","face_scan_id","is_auto_paid","status","stripe_payment_intent_id","created_at","updated_at"],"title":"IncomingPaymentRequestResponse"},"MerchantPaymentRequestCreate":{"properties":{"user_id":{"type":"string","title":"User Id","description":"Target user ID"},"stripe_connect_account_id":{"type":"string","title":"Stripe Connect Account Id","description":"Merchant's Stripe Connect account ID"},"business_name":{"type":"string","title":"Business Name","description":"Merchant business name for display (REQUIRED)"},"business_address":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Business Address","description":"Business address for customer context"},"business_category":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Business Category","description":"Business category (e.g., 'Restaurant', 'Retail', 'Gas Station')"},"business_phone":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Business Phone","description":"Business contact phone number"},"business_website":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Business Website","description":"Business website URL"},"amount":{"type":"number","exclusiveMinimum":0.0,"title":"Amount","description":"Amount in dollars (e.g., 1.50 for $1.50)"},"currency":{"type":"string","title":"Currency","description":"Currency code","default":"USD"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description","description":"Payment description/invoice details"},"order_number":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Order Number","description":"Merchant's order/invoice number for reference"},"items":{"anyOf":[{"items":{"type":"object"},"type":"array"},{"type":"null"}],"title":"Items","description":"List of items being purchased (optional)"},"face_scan_id":{"type":"string","title":"Face Scan Id","description":"Face scan ID from merchant terminal"},"stripe_payment_intent_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Stripe Payment Intent Id","description":"Stripe payment intent ID"},"merchant_payment_request_id":{"type":"string","title":"Merchant Payment Request Id","description":"Merchant's internal request ID"},"merchant_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Merchant Id","description":"Internal merchant ID for reference"},"amount_format":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Amount Format","description":"Specify 'dollars' or 'cents' to avoid confusion","default":"dollars"},"expires_at":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Expires At","description":"Payment request expiration time (ISO format)"},"receipt_email":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Receipt Email","description":"Email to send receipt to customer"},"tip_enabled":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Tip Enabled","description":"Whether tipping is enabled for this transaction","default":false},"tip_suggestions":{"anyOf":[{"items":{"type":"number"},"type":"array"},{"type":"null"}],"title":"Tip Suggestions","description":"Suggested tip percentages [15, 18, 20]"},"loyalty_points_earned":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Loyalty Points Earned","description":"Loyalty points customer will earn"},"discount_applied":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Discount Applied","description":"Discount amount applied"}},"type":"object","required":["user_id","stripe_connect_account_id","business_name","amount","face_scan_id","merchant_payment_request_id"],"title":"MerchantPaymentRequestCreate"},"PaymentApprovalResponse":{"properties":{"status":{"type":"string","title":"Status"},"transaction_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Transaction Id"}},"type":"object","required":["status"],"title":"PaymentApprovalResponse"},"PaymentDeclineResponse":{"properties":{"status":{"type":"string","title":"Status","default":"DECLINED"}},"type":"object","title":"PaymentDeclineResponse"},"PaymentMethodCreate":{"properties":{"stripe_payment_method_id":{"type":"string","title":"Stripe Payment Method Id"},"last4":{"type":"string","maxLength":4,"minLength":4,"title":"Last4"},"brand":{"type":"string","title":"Brand"},"exp_month":{"type":"integer","maximum":12.0,"minimum":1.0,"title":"Exp Month"},"exp_year":{"type":"integer","maximum":2050.0,"minimum":2024.0,"title":"Exp Year"},"is_default":{"type":"boolean","title":"Is Default","default":false}},"type":"object","required":["stripe_payment_method_id","last4","brand","exp_month","exp_year"],"title":"PaymentMethodCreate"},"PaymentMethodCreateSecure":{"properties":{"stripe_payment_method_id":{"type":"string","minLength":3,"title":"Stripe Payment Method Id","description":"Stripe payment method ID (pm_...)"},"is_default":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Is Default","default":false}},"type":"object","required":["stripe_payment_method_id"],"title":"PaymentMethodCreateSecure","description":"Secure payment method creation - only requires Stripe payment method ID"},"PaymentMethodInfo":{"properties":{"card_brand":{"type":"string","title":"Card Brand"},"card_last_four":{"type":"string","title":"Card Last Four"},"card_exp_month":{"type":"integer","title":"Card Exp Month"},"card_exp_year":{"type":"integer","title":"Card Exp Year"}},"type":"object","required":["card_brand","card_last_four","card_exp_month","card_exp_year"],"title":"PaymentMethodInfo"},"PaymentMethodResponse":{"properties":{"id":{"type":"string","title":"Id"},"card_last_four":{"type":"string","title":"Card Last Four"},"card_brand":{"type":"string","title":"Card Brand"},"card_exp_month":{"type":"integer","title":"Card Exp Month"},"card_exp_year":{"type":"integer","title":"Card Exp Year"},"is_default":{"type":"boolean","title":"Is Default"},"created_at":{"type":"string","format":"date-time","title":"Created At"}},"type":"object","required":["id","card_last_four","card_brand","card_exp_month","card_exp_year","is_default","created_at"],"title":"PaymentMethodResponse"},"PaymentMethodUpdate":{"properties":{"is_default":{"type":"boolean","title":"Is Default"}},"type":"object","required":["is_default"],"title":"PaymentMethodUpdate"},"PaymentStatus":{"type":"string","enum":["PENDING","COMPLETED","FAILED"],"title":"PaymentStatus"},"PhoneVerificationRequest":{"properties":{"phone_number":{"type":"string","maxLength":16,"minLength":10,"title":"Phone Number","description":"E.164 format phone number (e.g., +1234567890, +919876543210)"}},"type":"object","required":["phone_number"],"title":"PhoneVerificationRequest"},"PhoneVerifiedUserRegistration":{"properties":{"full_name":{"type":"string","maxLength":100,"minLength":2,"title":"Full Name","description":"User's full name"},"email":{"type":"string","format":"email","title":"Email","description":"User's email address"},"phone_number":{"type":"string","maxLength":16,"minLength":10,"title":"Phone Number","description":"E.164 format phone number (e.g., +1234567890)"},"password":{"type":"string","minLength":8,"title":"Password","description":"Password (min 8 chars, 1 number, 1 letter, 1 special char)"}},"type":"object","required":["full_name","email","phone_number","password"],"title":"PhoneVerifiedUserRegistration"},"RefreshTokenRequest":{"properties":{"refresh_token":{"type":"string","title":"Refresh Token"}},"type":"object","required":["refresh_token"],"title":"RefreshTokenRequest"},"Token":{"properties":{"access_token":{"type":"string","title":"Access Token"},"refresh_token":{"type":"string","title":"Refresh Token"},"token_type":{"type":"string","title":"Token Type","default":"bearer"},"expires_in":{"type":"integer","title":"Expires In"},"user":{"type":"object","title":"User"}},"type":"object","required":["access_token","refresh_token","expires_in","user"],"title":"Token"},"TransactionDetailResponse":{"properties":{"id":{"type":"string","title":"Id"},"merchant_id":{"type":"string","title":"Merchant Id"},"merchant_name":{"type":"string","title":"Merchant Name"},"amount":{"type":"integer","title":"Amount"},"currency":{"type":"string","title":"Currency"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"timestamp":{"type":"string","format":"date-time","title":"Timestamp"},"status":{"type":"string","title":"Status"},"payment_method_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Payment Method Id"},"stripe_transaction_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Stripe Transaction Id"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"is_auto_paid":{"type":"boolean","title":"Is Auto Paid"},"payment_method":{"anyOf":[{"$ref":"#/components/schemas/PaymentMethodInfo"},{"type":"null"}]},"receipt_url":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Receipt Url"}},"type":"object","required":["id","merchant_id","merchant_name","amount","currency","created_at","timestamp","status","payment_method_id","stripe_transaction_id","description","is_auto_paid","payment_method","receipt_url"],"title":"TransactionDetailResponse"},"TransactionResponse":{"properties":{"id":{"type":"string","title":"Id"},"user_id":{"type":"string","title":"User Id"},"merchant_id":{"type":"string","title":"Merchant Id"},"merchant_name":{"type":"string","title":"Merchant Name"},"amount":{"type":"integer","title":"Amount"},"currency":{"type":"string","title":"Currency"},"status":{"type":"string","title":"Status"},"payment_method_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Payment Method Id"},"stripe_payment_intent_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Stripe Payment Intent Id"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"updated_at":{"type":"string","format":"date-time","title":"Updated At"}},"type":"object","required":["id","user_id","merchant_id","merchant_name","amount","currency","status","payment_method_id","stripe_payment_intent_id","description","created_at","updated_at"],"title":"TransactionResponse"},"UserLogin":{"properties":{"username":{"type":"string","title":"Username"},"password":{"type":"string","title":"Password"}},"type":"object","required":["username","password"],"title":"UserLogin"},"UserRegistration":{"properties":{"phone_number":{"type":"string","maxLength":16,"minLength":10,"title":"Phone Number","description":"E.164 format phone number (e.g., +1234567890)"},"email":{"anyOf":[{"type":"string","format":"email"},{"type":"null"}],"title":"Email"},"password":{"type":"string","minLength":8,"title":"Password"},"profile_info":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Profile Info"}},"type":"object","required":["phone_number","password"],"title":"UserRegistration"},"UserUpdate":{"properties":{"email":{"anyOf":[{"type":"string","format":"email"},{"type":"null"}],"title":"Email"},"profile_info":{"anyOf":[{"type":"object"},{"type":"null"}],"title":"Profile Info"}},"type":"object","title":"UserUpdate"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"},"VerificationCodeRequest":{"properties":{"phone_number":{"type":"string","maxLength":16,"minLength":10,"title":"Phone Number","description":"E.164 format phone number (e.g., +1234567890, +919876543210)"},"code":{"type":"string","maxLength":10,"minLength":4,"title":"Code","description":"Verification code received via SMS"}},"type":"object","required":["phone_number","code"],"title":"VerificationCodeRequest"},"VerificationResponse":{"properties":{"success":{"type":"boolean","title":"Success"},"message":{"type":"string","title":"Message"}},"type":"object","required":["success","message"],"title":"VerificationResponse"}},"securitySchemes":{"HTTPBearer":{"type":"http","scheme":"bearer"}}}}